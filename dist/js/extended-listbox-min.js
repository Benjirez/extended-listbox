/* Extended Listbox 1.0.3; (c) 2015 Christian Kotzbauer; BSD-3-Clause License */ 
var ExtendedListbox;!function(t){var e=function(){function t(){this.searchBar=!1,this.searchBarWatermark="Search...",this.searchBarButton=new s,this.multiple=!1,this.getItems=null,this.onValueChanged=null,this.onFilterChanged=null,this.onItemsChanged=null}return t}();t.ListboxSettings=e;var s=function(){function t(){this.visible=!1,this.icon=null,this.onClick=null}return t}();t.ListBoxSearchButtonSettings=s}(ExtendedListbox||(ExtendedListbox={}));var ExtendedListbox;!function(t){var e=function(){function t(t,e){this._parent=t,this._settings=e,this._createListbox()}return t.prototype._createListbox=function(){this._parent.addClass(t.MAIN_CLASS),this._settings.searchBar&&this._createSearchbar(),this._createList()},t.prototype._createSearchbar=function(){var e=$("<div>").addClass(t.SEARCHBAR_CLASS+"-wrapper").appendTo(this._parent),s=$("<input>").addClass(t.SEARCHBAR_CLASS).appendTo(e).attr("placeholder",this._settings.searchBarWatermark),i=this;if(s.keyup(function(){var e=$(this).val().toLowerCase();""!==e?(i._list.find("."+t.LIST_ITEM_CLASS).each(function(){var s=$(this);if(!s.hasClass(t.LIST_ITEM_CLASS_GROUP)){var i=s.text().toLowerCase();-1!=i.search("^"+e)?(s.css("display","block"),s.parent().css("display","block")):s.css("display","none")}}),i._list.find("."+t.LIST_ITEM_CLASS_GROUP).each(function(){var t=$(this);0===t.children(":visible").length?t.css("display","none"):t.css("display","block")})):i._list.find("."+t.LIST_ITEM_CLASS).each(function(){$(this).css("display","block")}),i.onFilterChange&&i.onFilterChange()}),this._settings.searchBarButton.visible){var n=$("<button>").attr("id","searchBarButton").attr("tabindex","-1").addClass(t.SEARCHBAR_BUTTON_CLASS).appendTo(e);this._settings.searchBarButton.onClick&&n.click(this._settings.searchBarButton.onClick),$("<i>").addClass(this._settings.searchBarButton.icon).appendTo(n)}this._searchbarWrapper=e,this._searchbar=s},t.prototype._createList=function(){if(this._list=$("<div>").addClass(t.LIST_CLASS).appendTo(this._parent),this._resizeListToListbox(),this._settings.getItems){var e=this._settings.getItems();if(e){var s;for(s in e)this.addItem(this._prepareDataItem(e[s]),!0)}}},t.prototype._generateItemId=function(){var t=parseInt(""+1e7*Math.random(),10);return"listboxitem"+t},t.prototype._prepareDataItem=function(t){var e={text:null,id:this._generateItemId(),index:null,disabled:!1,selected:!1,groupHeader:!1,parentGroupId:null,childItems:[]};if("string"==typeof t||"number"==typeof t)return e.text=t,e;var s,i=$.extend(e,t),n=[];for(s=0;s<i.childItems.length;s++)n.push(this._prepareDataItem(i.childItems[s]));return i.childItems=n,i},t.prototype._addItem=function(e,s,i){var n=this,a=$("<div>").addClass(t.LIST_ITEM_CLASS).text(e.text).attr("id",e.id).attr("title",e.text).data("dataItem",e).click(function(){n.onItemClick($(this))});if(e.disabled&&a.addClass(t.LIST_ITEM_CLASS_DISABLED),e.groupHeader&&a.addClass(t.LIST_ITEM_CLASS_GROUP),e.selected&&this.onItemClick(a),e.parentGroupId){var r=$("#"+e.parentGroupId,this._list);0===r.length&&(r=$('div[title="'+e.parentGroupId+'"]')),r.length>0&&(i=r)}i&&a.addClass(t.LIST_ITEM_CLASS_CHILD);var o=i?i:this._list;if(void 0===e.index||null===e.index||s?a.appendTo(o):(o=o.children().eq(e.index),a.insertBefore(o)),e.childItems&&e.childItems.length>0){a.hasClass(t.LIST_ITEM_CLASS_GROUP)||a.addClass(t.LIST_ITEM_CLASS_GROUP);var l;for(l=0;l<e.childItems.length;l++){var h=e.childItems[l];this._addItem(h,s,a)}}return e.id},t.prototype.addItem=function(t,e){e||this._settings.multiple||!t.selected||this.clearSelection(e);var s=this._addItem(this._prepareDataItem(t),e,null);return e||this._settings.onItemsChanged&&this._settings.onItemsChanged(this.getItems()),s},t.prototype.removeItem=function(e){var s,i=this._list.find("."+t.LIST_ITEM_CLASS);for(s in i){var n=$(i[s]);if(n.text()===e||n.attr("id")===e)return this._clearItemSelection(n),n.remove(),void(this._settings.onItemsChanged&&this._settings.onItemsChanged(this.getItems()))}},t.prototype.destroy=function(){this._parent.children().remove(),this._parent.removeClass(t.MAIN_CLASS)},t.prototype._resizeListToListbox=function(){var t=this._parent.height();this._settings.searchBar&&(t-=this._searchbarWrapper.outerHeight(!0)),this._list.height(t)},t.prototype.clearSelection=function(e){var s=this._list.find("."+t.LIST_ITEM_CLASS);s.removeClass(t.LIST_ITEM_CLASS_SELECTED);var i;for(i=0;i<s.length;i++)$(s[i]).data("dataItem").selected=!1;this._settings.multiple?this._parent.val([]):this._parent.val(null),e||this._parent.trigger("change")},t.prototype._clearItemSelection=function(e){if(e.removeClass(t.LIST_ITEM_CLASS_SELECTED),e.data("dataItem").selected=!1,this._settings.multiple){var s=this._parent.val(),i=s.indexOf(JSON.stringify(e.data("dataItem")));s.splice(i,1),this._parent.val(s)}else this._parent.val(null);this._parent.trigger("change")},t.prototype.getItem=function(t){var e=null,s=$("#"+t,this._list);return 0===s.length&&(s=$('div[title="'+t+'"]')),s.length>0&&(e=s.data("dataItem")),e},t.prototype.getItems=function(){var t,e=[],s=this._list.children();for(t=0;t<s.length;t++)e.push($(s[t]).data("dataItem"));return e},t.prototype.moveItemUp=function(t){var e=null,s=$("#"+t,this._list);return 0===s.length&&(s=$('div[title="'+t+'"]')),s.length>0&&(s.insertBefore(s.prev()),e=s.index(),s.data("dataItem").index=e),this._settings.onItemsChanged&&this._settings.onItemsChanged(this.getItems()),e},t.prototype.moveItemDown=function(t){var e=null,s=$("#"+t,this._list);return 0===s.length&&(s=$('div[title="'+t+'"]')),s.length>0&&(s.insertAfter(s.next()),e=s.index(),s.data("dataItem").index=e),this._settings.onItemsChanged&&this._settings.onItemsChanged(this.getItems()),e},t.MAIN_CLASS="listbox-root",t.LIST_CLASS="listbox",t.LIST_ITEM_CLASS="listbox-item",t.LIST_ITEM_CLASS_DISABLED="listbox-item-disabled",t.LIST_ITEM_CLASS_SELECTED="listbox-item-selected",t.LIST_ITEM_CLASS_GROUP="listbox-item-group",t.LIST_ITEM_CLASS_CHILD="listbox-item-child",t.SEARCHBAR_CLASS="listbox-searchbar",t.SEARCHBAR_BUTTON_CLASS="listbox-searchbar-button",t}();t.BaseListBox=e}(ExtendedListbox||(ExtendedListbox={}));var __extends=this&&this.__extends||function(t,e){function s(){this.constructor=t}for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i]);t.prototype=null===e?Object.create(e):(s.prototype=e.prototype,new s)},ExtendedListbox;!function(t){var e=function(e){function s(t,s){e.call(this,t,s)}return __extends(s,e),s.prototype.onItemClick=function(e){if(!e.hasClass(t.BaseListBox.LIST_ITEM_CLASS_DISABLED)&&!e.hasClass(t.BaseListBox.LIST_ITEM_CLASS_GROUP)){var s=this._parent.val();if(e.hasClass(t.BaseListBox.LIST_ITEM_CLASS_SELECTED)){e.removeClass(t.BaseListBox.LIST_ITEM_CLASS_SELECTED);var i=s.indexOf(JSON.stringify(e.data("dataItem")));s.splice(i,1),e.data("dataItem").selected=!1}else e.addClass(t.BaseListBox.LIST_ITEM_CLASS_SELECTED),e.data("dataItem").selected=!0,s||(s=[]),s.push(JSON.stringify(e.data("dataItem")));this._parent.val(s),this._parent.trigger("change"),this._settings.onValueChanged&&this._settings.onValueChanged(s)}},s.prototype.onFilterChange=function(){},s}(t.BaseListBox);t.MultiSelectListbox=e}(ExtendedListbox||(ExtendedListbox={}));var ExtendedListbox;!function(t){var e=function(e){function s(t,s){e.call(this,t,s),this._selectedDomItem=null}return __extends(s,e),s.prototype.onItemClick=function(e){e.hasClass(t.BaseListBox.LIST_ITEM_CLASS_DISABLED)||e.hasClass(t.BaseListBox.LIST_ITEM_CLASS_GROUP)||(this._selectedDomItem&&(this.clearSelection(!0),this._selectedDomItem=null),e.toggleClass(t.BaseListBox.LIST_ITEM_CLASS_SELECTED),this._selectedDomItem=e,e.data("dataItem").selected=!0,this._parent.val(e.data("dataItem")),this._parent.trigger("change"),this._settings.onValueChanged&&this._settings.onValueChanged(e.data("dataItem")))},s.prototype.onFilterChange=function(){if(!this._selectedDomItem||!this._selectedDomItem.is(":visible")){var t=this._list.children(":visible").first();t&&t.length>0&&this.onItemClick(t)}this._settings.onFilterChanged&&this._settings.onFilterChanged(this._searchbar.val())},s}(t.BaseListBox);t.SingleSelectListbox=e}(ExtendedListbox||(ExtendedListbox={}));var ExtendedListbox;!function(t){function e(e){var s=$.extend({searchBar:!1,searchBarWatermark:"Search...",searchBarButton:{visible:!1,icon:null,onClick:null},multiple:!1,getItems:null,onValueChanged:null,onFilterChanged:null,onItemsChanged:null},e);return this.each(function(){var e;return e=s.multiple?new t.MultiSelectListbox($(this),s):new t.SingleSelectListbox($(this),s),$(this).data("listbox",e),!!e})}function s(t,e){var s=["addItem","removeItem","destroy","getItem","getItems","moveItemUp","moveItemDown","clearSelection"],i=null;return this.each(function(){var n=$(this).data("listbox");if(null==n&&window.console&&console.error)return void console.error("The listbox('"+t+"') method was called on an element that is not using ListBox.");if(-1===$.inArray(t,s))return void console.error(""+t+" is no public API function.");var a=Array.prototype.slice.call(e,1);i=n[t].apply(n,a)}),i}$.fn.listbox=function(t){return"object"==typeof t?e.call(this,t):"string"==typeof t?s.call(this,t,arguments):void 0}}(ExtendedListbox||(ExtendedListbox={}));